{
    "collab_server" : "",
    "contents" : "## Move the survey files from the SD card to a hard drive.\nlist.files(path = \"/Volumes/Untitled 1/Stand 33 Audio_loc13/Data\")\nmetadata <- fileCopyRename(from = \"/Volumes/Untitled 1/Stand 33 Audio_loc13/Data\",\n               to = \"/Volumes/Untitled\", csv.dir = \"/Users/johnlloyd/GitHub/BITH_Maine\",\n               csv.name = \"surveyMetadataMaine2016.csv\", loc.prefix = \"W33L13\",\n               ext = \"wav\", CardRecorderID = 6, rec.tz = \"US/Eastern\")\n\n## As with other upload functions, I needed to rewrite the function. It had two problems:\n## 1) It again tried to insert NULL into a primary key column that cannot be null (pkSurveyID)\n## 2) it pasted a weird \"//t\" character into the INSERT statement.\ndbUploadSurvey <- function (db.name, uid, pwd, survey.meta, update.query = FALSE, \n                            tz, ...) \n{\n  if (!requireNamespace(\"RODBC\", quietly = TRUE)) {\n    stop(\"The RODBC package is needed to use this function, but it is not installed. Please install it.\", \n         call. = FALSE)\n  }\n  start.time <- Sys.time()\n  if (missing(uid) && missing(pwd)) {\n    dbCon <- RODBC::odbcConnect(db.name, ...)\n  }\n  else if (missing(uid)) {\n    dbCon <- RODBC::odbcConnect(db.name, pwd, ...)\n  }\n  else dbCon <- RODBC::odbcConnect(db.name, uid, pwd, ...)\n  on.exit(close(dbCon))\n  if (!\"fldOriginalDateModified\" %in% names(survey.meta)) {\n    date.time.info <- regmatches(survey.meta[, \"fldSurveyName\"], \n                                 regexpr(\"[0-9]{4}-[0-9]{2}-[0-9]{2}[ _][0-9]{6}[ _][A-Z][SDM]T\", \n                                         survey.meta[, \"fldSurveyName\"]))\n    if (length(date.time.info) >= 1 && nchar(date.time.info) == \n        21) {\n      dm <- substr(survey.meta[, \"fldSurveyName\"], start = 8, \n                   stop = 24)\n      dm <- as.Date(dm, format = \"%Y-%m-%d_%H%M%S\")\n      dm <- as.POSIXct(dm, tz = tz, format = \"%Y-%m-%d_%H%M%S %Z\")\n      survey.meta[\"fldOriginalDateModified\"] <- as.character(dm, \n                                                             format = \"%Y-%m-%d_%H%M%S %Z\")\n    }\n    else stop(\"No time in metadata and file name does not have date and time info.\")\n  }\n  if (!update.query) {\n    mtimes <- survey.meta[, \"fldOriginalDateModified\"]\n    dates <- substr(mtimes, start = 1, stop = 11)\n    hh <- substr(mtimes, start = 12, stop = 13)\n    mm <- substr(mtimes, start = 14, stop = 15)\n    ss <- substr(mtimes, start = 16, stop = 17)\n    date.time <- paste0(unlist(dates), unlist(hh), \":\", unlist(mm), \n                        \":\", unlist(ss))\n    tzone <- substr(mtimes, start = 19, stop = 21)\n  }\n  empty <- !c(\"fkCardRecorderID\", \"fldSurveyLength\", \"fldOriginalDateModified\", \n              \"fldTimeZone\", \"fldOriginalRecordingName\", \"fldSurveyName\", \n              \"fldRecordingFormat\", \"fldSampleRate\", \"fldBitsperSample\", \n              \"fldChannels\") %in% names(survey.meta)\n  empty <- c(\"fkCardRecorderID\", \"fldSurveyLength\", \"fldOriginalDateModified\", \n             \"fldTimeZone\", \"fldOriginalRecordingName\", \"fldSurveyName\", \n             \"fldRecordingFormat\", \"fldSampleRate\", \"fldBitsperSample\", \n             \"fldChannels\")[empty]\n  survey.meta[empty] <- NA\n  if (!update.query) {\n    query <- paste(\"INSERT INTO `tblSurvey` (`fkCardRecorderID`, `fldSurveyLength`, `fldOriginalDateModified`, `fldTimeZone`, `fldOriginalRecordingName`, `fldSurveyName`, `fldRecordingFormat`, `fldSampleRate`, `fldBitsperSample`, `fldChannels`) VALUES ('\", \n                   paste(survey.meta$fkCardRecorder, \"', '\", \n                         survey.meta$fldSurveyLength, \"', '\", date.time, \n                         \"', '\", tzone, \"', '\", survey.meta$fldOriginalRecordingName, \n                         \"', '\", survey.meta$fldSurveyName, \"', '\", survey.meta$fldRecordingFormat, \n                         \"', '\", survey.meta$fldSampleRate, \"', '\", \n                         survey.meta$fldBitsperSample, \"', '\", survey.meta$fldChannels, \n                         \"')\", sep = \"\", collapse = \", ('\"), sep = \"\")\n  }\n  else {\n    query <- paste(\"UPDATE `tblSurvey` SET `fldSurveyLength` = '\", \n                   survey.meta$fldSurveyLength, \"', `fldSampleRate` = '\", \n                   survey.meta$fldSampleRate, \"', `fldBitsperSample` = '\", \n                   survey.meta$fldBitsperSample, \"', `fldChannels` = '\", \n                   survey.meta$fldChannels, \"' WHERE `fldSurveyName` = '\", \n                   survey.meta$fldSurveyName, \"'\", sep = \"\")\n  }\n  if (update.query) {\n    status <- lapply(X = query, FUN = RODBC::sqlQuery, channel = dbCon)\n  }\n  else {\n    status <- RODBC::sqlQuery(dbCon, query)\n  }\n  message(if (is.na(status[1])) {\n    paste(\"Done! Upload time:\", round(Sys.time() - start.time, \n                                      2), \"seconds\")\n  }\n  else if (status[1] == \"character(0)\") {\n    paste(\"Done! Upload time:\", round(Sys.time() - start.time, \n                                      2), \"seconds\")\n  }\n  else paste(\"Upload unsuccessful; RODBC returned errors: \", \n             paste(status, collapse = \" \")))\n}\n\n\n\ndbUploadSurvey(survey.meta = metadata, db.name = \"noh\", uid = \"root\",\n               pwd = \"RSW4xN!!\")\n\n#W34L10\nlist.files(path = \"/Volumes/Untitled 1/\")\nmetadata <- fileCopyRename(from = \"/Volumes/Untitled 1/Stand 34 Audio_loc10/Data\",\n                           to = \"/Volumes/Untitled\", csv.dir = \"/Users/johnlloyd/GitHub/BITH_Maine\",\n                           csv.name = \"surveyMetadataMaine2016.csv\", loc.prefix = \"W34L10\",\n                           ext = \"wav\", CardRecorderID = 7, rec.tz = \"US/Eastern\")\ndbUploadSurvey(survey.meta = metadata, db.name = \"noh\", uid = \"root\",\n               pwd = \"RSW4xN!!\")\n\n#W43L12\nlist.files(path = \"/Volumes/Untitled 1/\")\nmetadata <- fileCopyRename(from = \"/Volumes/Untitled 1/Data\",\n                           to = \"/Volumes/Untitled\", csv.dir = \"/Users/johnlloyd/GitHub/BITH_Maine\",\n                           csv.name = \"surveyMetadataMaine2016.csv\", loc.prefix = \"W43L12\",\n                           ext = \"wav\", CardRecorderID = 10, rec.tz = \"US/Eastern\")\ndbUploadSurvey(survey.meta = metadata, db.name = \"noh\", uid = \"root\",\n               pwd = \"RSW4xN!!\")\n\n#WS43L6\nmetadata <- fileCopyRename(from = \"/Volumes/Untitled 1/Data\",\n                           to = \"/Volumes/Untitled\", csv.dir = \"/Users/johnlloyd/GitHub/BITH_Maine\",\n                           csv.name = \"surveyMetadataMaine2016.csv\", loc.prefix = \"WS43L6\",\n                           ext = \"wav\", CardRecorderID = 8, rec.tz = \"US/Eastern\")\ndbUploadSurvey(survey.meta = metadata, db.name = \"noh\", uid = \"root\",\n               pwd = \"RSW4xN!!\")\n\n#WS46L1\nmetadata <- fileCopyRename(from = \"/Volumes/Untitled 1/Data\",\n                           to = \"/Volumes/Untitled\", csv.dir = \"/Users/johnlloyd/GitHub/BITH_Maine\",\n                           csv.name = \"surveyMetadataMaine2016.csv\", loc.prefix = \"WS46L1\",\n                           ext = \"wav\", CardRecorderID = 5, rec.tz = \"US/Eastern\")\ndbUploadSurvey(survey.meta = metadata, db.name = \"noh\", uid = \"root\",\n               pwd = \"RSW4xN!!\")\n\n#WS35L9\nmetadata <- fileCopyRename(from = \"/Volumes/Untitled 1/Stand 35 Audio_loc9/Data\",\n                           to = \"/Volumes/Untitled\", csv.dir = \"/Users/johnlloyd/GitHub/BITH_Maine\",\n                           csv.name = \"surveyMetadataMaine2016.csv\", loc.prefix = \"WS35L9\",\n                           ext = \"wav\", CardRecorderID = 3, rec.tz = \"US/Eastern\")\ndbUploadSurvey(survey.meta = metadata, db.name = \"noh\", uid = \"root\",\n               pwd = \"RSW4xN!!\")\n\n#WS28L8\nmetadata <- fileCopyRename(from = \"/Volumes/Untitled 1/Stand 28 Audio_loc8/Data\",\n                           to = \"/Volumes/Untitled\", csv.dir = \"/Users/johnlloyd/GitHub/BITH_Maine\",\n                           csv.name = \"surveyMetadataMaine2016.csv\", loc.prefix = \"WS28L8\",\n                           ext = \"wav\", CardRecorderID = 9, rec.tz = \"US/Eastern\")\ndbUploadSurvey(survey.meta = metadata, db.name = \"noh\", uid = \"root\",\n               pwd = \"RSW4xN!!\")\n\n#W28L11\nmetadata <- fileCopyRename(from = \"/Volumes/Untitled 1/Data\",\n                           to = \"/Volumes/Untitled\", csv.dir = \"/Users/johnlloyd/GitHub/BITH_Maine\",\n                           csv.name = \"surveyMetadataMaine2016.csv\", loc.prefix = \"W28L11\",\n                           ext = \"wav\", CardRecorderID = 12, rec.tz = \"US/Eastern\")\ndbUploadSurvey(survey.meta = metadata, db.name = \"noh\", uid = \"root\",\n               pwd = \"RSW4xN!!\")\n\n#WS41L5\nmetadata <- fileCopyRename(from = \"/Volumes/Untitled 1/Data\",\n                           to = \"/Volumes/Untitled\", csv.dir = \"/Users/johnlloyd/GitHub/BITH_Maine\",\n                           csv.name = \"surveyMetadataMaine2016.csv\", loc.prefix = \"WS41L5\",\n                           ext = \"wav\", CardRecorderID = 4, rec.tz = \"US/Eastern\")\ndbUploadSurvey(survey.meta = metadata, db.name = \"noh\", uid = \"root\",\n               pwd = \"RSW4xN!!\")\n\n#WS44L2\nmetadata <- fileCopyRename(from = \"/Volumes/Untitled 1/Data\",\n                           to = \"/Volumes/Untitled\", csv.dir = \"/Users/johnlloyd/GitHub/BITH_Maine\",\n                           csv.name = \"surveyMetadataMaine2016.csv\", loc.prefix = \"WS44L2\",\n                           ext = \"wav\", CardRecorderID = 11, rec.tz = \"US/Eastern\")\ndbUploadSurvey(survey.meta = metadata, db.name = \"noh\", uid = \"root\",\n               pwd = \"RSW4xN!!\")\n\n#WS43L4\nmetadata <- fileCopyRename(from = \"/Volumes/Untitled 1/Data\",\n                           to = \"/Volumes/Untitled\", csv.dir = \"/Users/johnlloyd/GitHub/BITH_Maine\",\n                           csv.name = \"surveyMetadataMaine2016.csv\", loc.prefix = \"WS43L4\",\n                           ext = \"wav\", CardRecorderID = 2, rec.tz = \"US/Eastern\")\ndbUploadSurvey(survey.meta = metadata, db.name = \"noh\", uid = \"root\",\n               pwd = \"RSW4xN!!\")\n\n#WS33L7\nmetadata <- fileCopyRename(from = \"/Volumes/Untitled 1/Data\",\n                           to = \"/Volumes/Untitled\", csv.dir = \"/Users/johnlloyd/GitHub/BITH_Maine\",\n                           csv.name = \"surveyMetadataMaine2016.csv\", loc.prefix = \"WS33L7\",\n                           ext = \"wav\", CardRecorderID = 1, rec.tz = \"US/Eastern\")\ndbUploadSurvey(survey.meta = metadata, db.name = \"noh\", uid = \"root\",\n               pwd = \"RSW4xN!!\")\n",
    "created" : 1506698015037.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1748806165",
    "id" : "401ABF8D",
    "lastKnownWriteTime" : 1510085664,
    "last_content_update" : 1510085664837,
    "path" : "~/GitHub/BITH_Maine/surveyUpload.R",
    "project_path" : "surveyUpload.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}